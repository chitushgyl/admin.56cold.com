(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0256c397"],{"037f":function(t,e,a){"use strict";a("309e")},"309e":function(t,e,a){},"344f":function(t,e,a){},"386d":function(t,e,a){"use strict";var n=a("cb7c"),i=a("83a1"),l=a("5f1b");a("214f")("search",1,(function(t,e,a,o){return[function(a){var n=t(this),i=void 0==a?void 0:a[e];return void 0!==i?i.call(a,n):new RegExp(a)[e](String(n))},function(t){var e=o(a,t,this);if(e.done)return e.value;var s=n(t),r=String(this),c=s.lastIndex;i(c,0)||(s.lastIndex=0);var d=l(s,r);return i(s.lastIndex,c)||(s.lastIndex=c),null===d?-1:d.index}]}))},"58fe":function(t,e,a){"use strict";a("86b6")},6724:function(t,e,a){"use strict";a("8d41");var n="@@wavesContext";function i(t,e){function a(a){var n=Object.assign({},e.value),i=Object.assign({ele:t,type:"hit",color:"rgba(0, 0, 0, 0.15)"},n),l=i.ele;if(l){l.style.position="relative",l.style.overflow="hidden";var o=l.getBoundingClientRect(),s=l.querySelector(".waves-ripple");switch(s?s.className="waves-ripple":(s=document.createElement("span"),s.className="waves-ripple",s.style.height=s.style.width=Math.max(o.width,o.height)+"px",l.appendChild(s)),i.type){case"center":s.style.top=o.height/2-s.offsetHeight/2+"px",s.style.left=o.width/2-s.offsetWidth/2+"px";break;default:s.style.top=(a.pageY-o.top-s.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",s.style.left=(a.pageX-o.left-s.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return s.style.backgroundColor=i.color,s.className="waves-ripple z-active",!1}}return t[n]?t[n].removeHandle=a:t[n]={removeHandle:a},a}var l={bind:function(t,e){t.addEventListener("click",i(t,e),!1)},update:function(t,e){t.removeEventListener("click",t[n].removeHandle,!1),t.addEventListener("click",i(t,e),!1)},unbind:function(t){t.removeEventListener("click",t[n].removeHandle,!1),t[n]=null,delete t[n]}},o=function(t){t.directive("waves",l)};window.Vue&&(window.waves=l,Vue.use(o)),l.install=o;e["a"]=l},"72bc":function(t,e,a){},"83a1":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"86b6":function(t,e,a){},"8d41":function(t,e,a){},a121:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"table-header header-fixed"},[a("div",{staticClass:"flex-space-between table-title-container"},[a("div",[t._v(t._s(t.title))]),t._v(" "),a("div",[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{size:"mini",type:"success"},on:{click:t.newStation}},[t._v("新增站点")])],1)])]),t._v(" "),a("el-container",[a("el-row",{staticStyle:{width:"100%"},attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"dragTable",staticClass:"myTable",staticStyle:{width:"100%"},attrs:{"row-key":"self_id",data:t.tableData,border:"",fit:"",height:"622"}},[a("el-table-column",{attrs:{type:"index",index:t.indexMethod,width:"40"}}),t._v(" "),a("el-table-column",{attrs:{label:"途经点",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-input",{staticStyle:{padding:"0 4px !important"},attrs:{placeholder:"请输入内容途经点",value:n.pathway_name},model:{value:n.pathway_name,callback:function(e){t.$set(n,"pathway_name",e)},expression:"row.pathway_name"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"准确地址","min-width":"180"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-input",{attrs:{placeholder:"请输入内容途经点的准确地址",value:n.pathway_address},model:{value:n.pathway_address,callback:function(e){t.$set(n,"pathway_address",e)},expression:"row.pathway_address"}},[a("template",{slot:"append"},[a("i",{staticClass:"el-icon-add-location",staticStyle:{"font-size":"20px"},attrs:{size:"mini",circle:""},on:{click:function(e){return t.textAddress(n.pathway_address,n)}}})])],2)]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"经纬度","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-input",{staticClass:"loglat",attrs:{value:n.loglat},model:{value:n.loglat,callback:function(e){t.$set(n,"loglat","string"===typeof e?e.trim():e)},expression:"row.loglat"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"是否强制到站","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-select",{attrs:{placeholder:"请选择"},model:{value:n.is_compel_arriver,callback:function(e){t.$set(n,"is_compel_arriver",e)},expression:"row.is_compel_arriver"}},[a("el-option",{attrs:{label:"是",value:"Y"}}),t._v(" "),a("el-option",{attrs:{label:"否",value:"N"}})],1)]}}])}),t._v(" "),t.show?a("el-table-column",{attrs:{label:"距离(米)",width:"100"},scopedSlots:t._u([{key:"default",fn:function(t){var e=t.row;return[a("el-input",{attrs:{readonly:"readonly",value:e.distance}})]}}],null,!1,2282494151)}):t._e(),t._v(" "),t.show?a("el-table-column",{attrs:{label:"时间(秒)",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row,i=e.$index;return[a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("el-input",{staticStyle:{"margin-right":"5px"},attrs:{readonly:"readonly",value:n.duration}}),t._v(" "),a("i",{staticClass:"el-icon-error",attrs:{size:"mini",circle:""},on:{click:function(e){return t.deleteChoose(i,n.self_id)}}})],1)]}}],null,!1,3935974832)}):t._e(),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row,i=e.$index;return[a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("i",{staticClass:"el-icon-error",attrs:{size:"mini",circle:""},on:{click:function(e){return t.deleteChoose(i,n.self_id)}}})])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"拖拽",width:"60","class-name":"drag-column"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("svg-icon",{staticClass:"drag-handler",attrs:{"icon-class":"drag"}})]}}])})],1)],1)]),t._v(" "),a("el-col",{attrs:{span:10}},[a("amap",{ref:"childmap",staticStyle:{padding:"5px"},attrs:{"default-value":t.postForm.detailedAddress,fathersearchValue:t.searchValue,showSearch:!1},on:{getPosition:t.getPosition,getPoly:t.getPoly}})],1)],1)],1),t._v(" "),a("div",{staticStyle:{width:"100%",margin:"10px 0"}},[a("div",{staticStyle:{width:"150px",margin:"auto",display:"flex"}},[a("el-button",{attrs:{type:"success"},on:{click:t.countDis}},[t._v("保存")]),t._v(" "),a("el-button",{attrs:{type:"success"},on:{click:t.showPath}},[t._v("线路规划")]),t._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.$router.go(-1)}}},[t._v("取消")])],1)]),t._v(" "),a("el-dialog",{staticStyle:{"margin-top":"-60px","padding-top":"10px"},attrs:{title:"请确认站点信息是否准确",visible:t.payFormVisible},on:{"update:visible":function(e){t.payFormVisible=e}}},[a("el-row",[a("el-col",{staticStyle:{"margin-top":"5px"},attrs:{span:24}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"dragTable",staticClass:"myTable",staticStyle:{width:"100%"},attrs:{"row-key":"self_id",data:t.tableData,border:"",fit:""}},[a("el-table-column",{attrs:{type:"index",index:t.indexMethod,width:"50"}}),t._v(" "),a("el-table-column",{attrs:{label:"途经点",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v("\n                      "+t._s(a.pathway_name)+"\n                  ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"准确地址","min-width":"180"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v("\n                      "+t._s(a.pathway_address)+"\n                  ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"经纬度",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v("\n                      "+t._s(a.loglat)+"                              \n                  ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"距离(米)",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v("\n                      "+t._s(a.distance)+"\n                  ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"时间(秒)",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v("\n                      "+t._s(a.duration)+"\n                  ")]}}])})],1)],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.payFormVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.upDate}},[t._v("提交")])],1)],1),t._v(" "),a("el-dialog",{staticStyle:{"margin-top":"0"},attrs:{title:"线路规划："+this.path_name,visible:t.pathShow,fullscreen:!1,width:"80%","lock-scroll:true":"",top:"10px",id:"containMap"},on:{"update:visible":function(e){t.pathShow=e}}},[a("linemap",{ref:"childmaps",staticStyle:{padding:"5px"},attrs:{showSearch:!1,tableInfo:t.tableData}})],1)],1)},i=[],l=(a("ac6a"),a("7f7f"),a("aa47")),o=a("6724"),s=a("e310"),r=a("81ed"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"amap-container"}},[a("el-row",{staticClass:"margin-top-10 address",staticStyle:{width:"100%",height:"20px","line-height":"20px"},attrs:{id:"pathResult"}},[t._v(t._s(t.pathResult))]),t._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{staticStyle:{"margin-top":"0"},attrs:{id:"childmaps"}})]),t._v(" "),a("el-col",{staticStyle:{display:"none"},attrs:{span:6}},[a("div",{staticClass:"rightContent"},[a("div",{staticClass:"rightTop"},[a("el-table",{ref:"dragTable",staticStyle:{width:"100%"},attrs:{border:"",fit:"",data:t.tableInfo}},[a("el-table-column",{attrs:{type:"index",index:t.indexMethod,"max-width":"30"}}),t._v(" "),a("el-table-column",{attrs:{label:"途经点"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v("\n                            "+t._s(a.pathway_name)+"\n                        ")]}}])})],1)],1),t._v(" "),a("div",{staticStyle:{display:"flex","justify-content":"center","margin-top":"10px"}})])])],1)],1)},d=[],u=(a("6b54"),a("f576"),a("386d"),a("28a5"),window.AMap),p={name:"AMap",props:{defaultValue:{type:String,default:""},showSearch:{type:Boolean},fathersearchValue:{type:String},tableInfo:{type:Array,default:[]}},data:function(){return{map:null,position:{},marker:"",pathResult:"",startPoint:[],endPoint:[],waypoints:[],markers:[],history_marker:[],drive:"",pathWay:[],originPath:[],self_id:""}},watch:{},mounted:function(){var t=this;this.initMap(),this.$nextTick((function(){t.setSort()}))},beforeDestroy:function(){this.map.destroy()},methods:{initMap:function(){var t=this;this.map=new u.Map("childmaps",{resizeEnable:!0,zoom:50}),this.map.plugin(["AMap.ToolBar","AMap.Scale","AMap.OverView"],(function(){var e=new u.ToolBar,a=new u.Scale,n=new u.OverView;t.map.addControl(e),t.map.addControl(a),t.map.addControl(n)}))},drawPtah:function(t,e,a,n){for(var i=this,l=this,o=[],s=0;s<t.length;s++){var r=t[s].loglat.split("*");o.push(r)}o.length>0&&(l.startPoint=o[0],l.endPoint=o[o.length-1],l.waypoints=o.filter((function(t,e){return e>0&&e<o.length-1})),this.map.plugin("AMap.Driving",(function(){l.drive&&(l.drive.clear(),console.log("规划清除了")),l.drive=new u.Driving({enableHighAccuracy:!0,timeout:1e4,map:i.map,autoFitView:!0}),l.drive.search(l.startPoint,l.endPoint,{waypoints:l.waypoints},(function(e,a){if("complete"===e){l.map.remove(l.markers),l.pathResult="全程".concat(l.$options.filters["distanceFilter"](a.routes[0].distance),",用时").concat(l.$options.filters["timeFilter"](a.routes[0].time));for(var n=0;n<t.length;n++){var i=new u.Marker({map:l.map,icon:new u.Icon({image:"https://bloodcity.oss-cn-beijing.aliyuncs.com/images/2020-08-10/e8dd359bdd0937fab5df328a83141e28.png",size:new u.Size(28,36),imageSize:new u.Size(28,36)}),position:o[n],offset:new u.Pixel(-13,-30),label:{content:"<div class='info' style='text-align:center'>第"+(n+1)+"站<br/>"+t[n].pathway_name+"</div>",direction:"top"}});l.markers.push(i)}}}))})))},getHistory:function(t,e,a){var n=this,i={path_name:a,path_id:t,site_type:e,time:this.getNowTime()};Object(s["fetchHistoryPathwayLine"])(i).then((function(t){if(t.data){t.data.path.length>0&&(n.pathWay.push(t.data),n.drawHistory());t.station}else pathSimplifierIns.setData([])}))},drawHistory:function(){var t=this,e=["#cccccc","#cccccc"];t.pathWay.length>0&&(window.pathSimplifierIns&&pathSimplifierIns.setData([]),AMapUI.loadUI(["misc/PathSimplifier"],(function(a){if(a.supportCanvas){var n=new a({zIndex:100,map:t.map,getPath:function(t,e){return t.path},getHoverTitle:function(t,e,a){return a>=0?t.name+"，点："+a+"/"+t.path.length:t.name+"，点数量"+t.path.length},renderOptions:{pathLineStyle:{dirArrowStyle:!0},getPathStyle:function(t,n){var i=e[t.pathIndex%e.length],l=Math.round(2*Math.pow(1.1,n-3));return{pathLineStyle:{strokeStyle:0==t.pathIndex?e[0]:e[1],lineWidth:l},pathLineSelectedStyle:{lineWidth:l+2},pathNavigatorStyle:{fillStyle:i,content:a.Render.Canvas.getImageContent("https://webapi.amap.com/images/car.png",(function(t){}),(function(t){console.log(t)})),initRotateDegree:-90,pathLinePassedStyle:null,width:30,height:20}}}}});window.pathSimplifierIns=n,n.setData(t.pathWay);var i=n.createPathNavigator(0,{loop:!0,speed:500});i.start(),n.setSelectedPathIndex(0),n.on("pathClick,pointClick",(function(e,a){var n=a.pathIndex,i=t.pathWay[n].self_id;t.removeMarkers(t.markers),t.get_ThisPath(t.pathInfo,i)}))}else alert("当前环境不支持 Canvas！")})))},getNowTime:function(){var t=new Date,e=t.getFullYear(),a=t.getMonth(),n=t.getDate()-1;a+=1,a=a.toString().padStart(2,"0"),n=n.toString().padStart(2,"0");var i="".concat(e,"-").concat(a,"-").concat(n);return i},indexMethod:function(t){return t+1},setSort:function(){var t=this,e=this.$refs.dragTable.$el.querySelectorAll(".el-table__body-wrapper > table > tbody")[0];this.sortable=l["default"].create(e,{handle:".drag-column",ghostClass:"sortable-ghost",setData:function(t){t.setData("Text","")},onEnd:function(e){var a=t.tableData.splice(e.oldIndex,1)[0];t.tableData.splice(e.newIndex,0,a)}})}},filters:{distanceFilter:function(t){return t?t>1e3?"".concat((t/1e3).toFixed(1),"公里"):t<=1e3?"".concat(t,"米"):t:""},timeFilter:function(t){if(0===t)return"已到站　";if(!t)return"----　";var e,a=parseInt(t),n=Math.floor(a/3600)>0?"".concat(Math.floor(a/3600),"小时"):"",i=a>0?"".concat(Math.floor(a%60)):"";return a/60%60>0&&(Math.floor(a/60%60)>0?(e="".concat(Math.floor(a/60%60)),i>30&&(e=parseInt(e)+1)):e="1"),a="".concat(n+e,"分钟　"),a}}},h=p,f=(a("037f"),a("58fe"),a("2877")),m=Object(f["a"])(h,c,d,!1,null,null,null),v=m.exports,g={components:{Amap:r["a"],Linemap:v},directives:{waves:o["a"]},data:function(){return{title:"",path_name:"",type:"",self_id:"",tableData:[{self_id:"",pathway_name:"",pathway_address:"",loglat:"",distance:"",duration:"",longitude:"",dimensionality:"",poly:"",is_compel_arriver:"Y"}],postForm:{detailedAddress:null,longitude:null,latitude:null},searchValue:"",flag:!0,list:null,total:null,listLoading:!0,sortable:null,oldList:[],newList:[],payFormVisible:!1,show:!1,on_flag:!0,pathShow:!1,site_type:"",group_code:""}},created:function(){var t=this;this.path_name=this.$route.query.path_name,this.self_id=this.$route.query.self_id,this.type=this.$route.query.type,this.getPathWay(),this.list=this.tableData,this.total=this.tableData.total,this.listLoading=!1,this.oldList=this.list.map((function(t){return t.id})),this.newList=this.oldList.slice(),this.$nextTick((function(){t.setSort()}))},methods:{getPathWay:function(){var t=this,e={self_id:this.self_id,type:this.type};Object(s["f"])(e).then((function(e){var a=e.data;t.group_code=a.group_info.group_code||"",t.site_type=a.group_info.site_type||"",t.path_name=e.data.group_info.path_name,a.info&&a.info.length>0&&(t.tableData=a.info),t.title="配置  线路："+e.data.group_info.path_name+" 的站点"}))},indexMethod:function(t){return t+1},setSort:function(){var t=this,e=this.$refs.dragTable.$el.querySelectorAll(".el-table__body-wrapper > table > tbody")[0];this.sortable=l["default"].create(e,{handle:".drag-column",ghostClass:"sortable-ghost",setData:function(t){t.setData("Text","")},onEnd:function(e){var a=t.tableData.splice(e.oldIndex,1)[0];t.tableData.splice(e.newIndex,0,a)}})},newStation:function(){this.flag=!1,this.tableData.push({self_id:"",pathway_name:"",pathway_address:"",loglat:"",distance:"",duration:"",longitude:"",dimensionality:"",poly:"",is_compel_arriver:"Y"})},deleteChoose:function(t,e){var a=this;if(this.tableData.splice(t,1),this.flag=!1,e){var n={self_id:e};Object(s["h"])(n).then((function(t){a.$message({message:"删除站点成功！",type:"success",center:!0})}))}},textAddress:function(t,e){this.flag=!1,this.searchValue=t,this.$refs.childmap.handelSearch(this.searchValue,e)},getPosition:function(t,e){var a=t.address,n=t.lat,i=t.lng;t.name;this.postForm.detailedAddress=a,this.postForm.longitude=String(i),this.postForm.latitude=String(n),e.longitude=String(i),e.dimensionality=String(n),e.pathway_address=a,e.loglat=String(i)+"*"+String(n)},getPoly:function(t,e){e.poly=t},countDis:function(){var t=this;this.tableData.forEach((function(e){""==e.loglat&&""==e.pathway_name&&""==e.pathway_address&&0==t.tableData.length&&(console.log(44444),t.on_flag=!1,t.$message({message:"站点信息不能为空！",type:"warning",center:!0}))})),this.on_flag&&(this.flag=!0,this.$refs.childmap.distanceCompute(this.tableData),this.payFormVisible=!0)},upDate:function(){var t=this,e={path_id:this.self_id,type:this.type,arr:JSON.stringify(this.tableData)};Object(s["g"])(e).then((function(e){t.$message({message:"数据提交成功！",type:"success",center:!0}),setTimeout((function(){t.$router.go(-1)}),1e3)}))},showPath:function(){var t=this;this.pathShow=!0,setTimeout((function(){t.$refs.childmaps.drawPtah(t.tableData,t.site_type,t.self_id,t.path_name)}),500)}},computed:{}},y=g,w=(a("c8da"),a("fdff"),a("f364"),Object(f["a"])(y,n,i,!1,null,"5ec10f5c",null));e["default"]=w.exports},c8da:function(t,e,a){"use strict";a("344f")},e310:function(t,e,a){"use strict";a.d(e,"d",(function(){return i})),a.d(e,"e",(function(){return l})),a.d(e,"b",(function(){return o})),a.d(e,"m",(function(){return s})),a.d(e,"a",(function(){return r})),a.d(e,"f",(function(){return c})),a.d(e,"h",(function(){return d})),a.d(e,"g",(function(){return u})),a.d(e,"i",(function(){return p})),a.d(e,"j",(function(){return h})),a.d(e,"k",(function(){return f})),a.d(e,"l",(function(){return m})),a.d(e,"n",(function(){return v}));var n=a("b775");function i(t){return Object(n["a"])({url:"/school/line/lineList",method:"get",params:t})}function l(t){return Object(n["a"])({url:"/school/line/linePage",method:"get",params:t})}function o(t){return Object(n["a"])({url:"company/company/getGroup",method:"get",params:t})}function s(t){return Object(n["a"])({url:"/school/line/lineAdd",method:"get",params:t})}function r(t){return Object(n["a"])({url:"/school/line/createLine",method:"get",params:t})}function c(t){return Object(n["a"])({url:"/school/line/linePathway",method:"get",params:t})}function d(t){return Object(n["a"])({url:"/school/line/linePathwayDelete",method:"get",params:t})}function u(t){return Object(n["a"])({url:"/school/line/linePathwayAdd",method:"get",params:t})}function p(t){return Object(n["a"])({url:"/school/line/pathwayStation",methods:"get",params:t})}function h(t){return Object(n["a"])({url:"/school/line/pathwayStudent",method:"get",params:t})}function f(t){return Object(n["a"])({url:"/school/line/pathwayStudentAdd",method:"get",params:t})}function m(t){return Object(n["a"])({url:"/school/line/studentImport",method:"get",params:t})}function v(t){return Object(n["a"])({url:"/school/line/lineExcel",methods:"get",params:t})}},f364:function(t,e,a){"use strict";a("72bc")},f7ca:function(t,e,a){},fdff:function(t,e,a){"use strict";a("f7ca")}}]);